{
  "openapi": "3.0.3",
  "info": {
    "title": "Maghemite Admin",
    "version": "v0.1.0"
  },
  "paths": {
    "/bfd/peers": {
      "get": {
        "summary": "Get all the peers and their associated BFD state. Peers are identified by IP",
        "description": "address.",
        "operationId": "get_bfd_peers",
        "responses": {
          "200": {
            "description": "successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Map_of_PeerState",
                  "type": "object",
                  "additionalProperties": {
                    "$ref": "#/components/schemas/PeerState"
                  }
                }
              }
            }
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "summary": "Add a new peer to the daemon. A session for the specified peer will start",
        "description": "immediately.",
        "operationId": "add_bfd_peer",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddBfdPeerRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/bfd/peers/{addr}": {
      "delete": {
        "summary": "Remove the specified peer from the daemon. The associated peer session will",
        "description": "be stopped immediately.",
        "operationId": "remove_bfd_peer",
        "parameters": [
          {
            "in": "path",
            "name": "addr",
            "description": "Address of the peer to remove.",
            "required": true,
            "schema": {
              "type": "string",
              "format": "ip"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/bgp/apply": {
      "post": {
        "operationId": "bgp_apply",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApplyRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/bgp/graceful_shutdown": {
      "post": {
        "operationId": "graceful_shutdown",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GracefulShutdownRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/bgp/imported4": {
      "get": {
        "operationId": "get_imported4",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GetImported4Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Array_of_Route4ImportKey",
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Route4ImportKey"
                  }
                }
              }
            }
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/bgp/neighbor": {
      "put": {
        "operationId": "ensure_neighbor_handler",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddNeighborRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "operationId": "add_neighbor_handler",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddNeighborRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "operationId": "delete_neighbor",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeleteNeighborRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "successful deletion"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/bgp/originate4": {
      "get": {
        "operationId": "get_originated4",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GetOriginated4Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Array_of_Prefix4",
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Prefix4"
                  }
                }
              }
            }
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "operationId": "originate4",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Originate4Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/bgp/router": {
      "put": {
        "operationId": "ensure_router_handler",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewRouterRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "post": {
        "operationId": "new_router",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewRouterRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "operationId": "delete_router",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeleteRouterRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/bgp/routers": {
      "get": {
        "operationId": "get_routers",
        "responses": {
          "200": {
            "description": "successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Array_of_RouterInfo",
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RouterInfo"
                  }
                }
              }
            }
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/bgp/withdraw4": {
      "post": {
        "operationId": "withdraw4",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Withdraw4Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/static/route4": {
      "get": {
        "operationId": "static_list_v4_routes",
        "responses": {
          "200": {
            "description": "successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StaticRoute4List"
                }
              }
            }
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "put": {
        "operationId": "static_add_v4_route",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddStaticRoute4Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      },
      "delete": {
        "operationId": "static_remove_v4_route",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeleteStaticRoute4Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "successful deletion"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "AddBfdPeerRequest": {
        "description": "Request to add a peer to the daemon.",
        "type": "object",
        "properties": {
          "detection_threshold": {
            "description": "Detection threshold for connectivity as a multipler to required_rx",
            "type": "integer",
            "format": "uint8",
            "minimum": 0
          },
          "listen": {
            "description": "Address to listen on for control messages from the peer.",
            "type": "string",
            "format": "ip"
          },
          "mode": {
            "description": "Mode is single-hop (RFC 5881) or multi-hop (RFC 5883).",
            "allOf": [
              {
                "$ref": "#/components/schemas/SessionMode"
              }
            ]
          },
          "peer": {
            "description": "Address of the peer to add.",
            "type": "string",
            "format": "ip"
          },
          "required_rx": {
            "description": "Acceptable time between control messages in microseconds.",
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          }
        },
        "required": [
          "detection_threshold",
          "listen",
          "mode",
          "peer",
          "required_rx"
        ]
      },
      "AddNeighborRequest": {
        "type": "object",
        "properties": {
          "asn": {
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          },
          "connect_retry": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          },
          "delay_open": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          },
          "group": {
            "type": "string"
          },
          "hold_time": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          },
          "host": {
            "type": "string"
          },
          "idle_hold_time": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          },
          "keepalive": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          },
          "name": {
            "type": "string"
          },
          "passive": {
            "type": "boolean"
          },
          "resolution": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          }
        },
        "required": [
          "asn",
          "connect_retry",
          "delay_open",
          "group",
          "hold_time",
          "host",
          "idle_hold_time",
          "keepalive",
          "name",
          "passive",
          "resolution"
        ]
      },
      "AddStaticRoute4Request": {
        "type": "object",
        "properties": {
          "routes": {
            "$ref": "#/components/schemas/StaticRoute4List"
          }
        },
        "required": [
          "routes"
        ]
      },
      "ApplyRequest": {
        "description": "Apply changes to an ASN.",
        "type": "object",
        "properties": {
          "asn": {
            "description": "ASN to apply changes to.",
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          },
          "originate": {
            "description": "Complete set of prefixes to originate. Any active prefixes not in this list will be removed. All prefixes in this list are ensured to be in the originating set.",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Prefix4"
            }
          },
          "peers": {
            "description": "Lists of peers indexed by peer group. Set's within a peer group key are a total set. For example, the value\n\n```text {\"foo\": [a, b, d]} ``` Means that the peer group \"foo\" only contains the peers `a`, `b` and `d`. If there is a peer `c` currently in the peer group \"foo\", it will be removed.",
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "$ref": "#/components/schemas/BgpPeerConfig"
              }
            }
          }
        },
        "required": [
          "asn",
          "originate",
          "peers"
        ]
      },
      "BgpPeerConfig": {
        "type": "object",
        "properties": {
          "connect_retry": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          },
          "delay_open": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          },
          "hold_time": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          },
          "host": {
            "type": "string"
          },
          "idle_hold_time": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          },
          "keepalive": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          },
          "name": {
            "type": "string"
          },
          "passive": {
            "type": "boolean"
          },
          "resolution": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          }
        },
        "required": [
          "connect_retry",
          "delay_open",
          "hold_time",
          "host",
          "idle_hold_time",
          "keepalive",
          "name",
          "passive",
          "resolution"
        ]
      },
      "DeleteNeighborRequest": {
        "type": "object",
        "properties": {
          "addr": {
            "type": "string",
            "format": "ip"
          },
          "asn": {
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          }
        },
        "required": [
          "addr",
          "asn"
        ]
      },
      "DeleteRouterRequest": {
        "type": "object",
        "properties": {
          "asn": {
            "description": "Autonomous system number for the router to remove",
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          }
        },
        "required": [
          "asn"
        ]
      },
      "DeleteStaticRoute4Request": {
        "type": "object",
        "properties": {
          "routes": {
            "$ref": "#/components/schemas/StaticRoute4List"
          }
        },
        "required": [
          "routes"
        ]
      },
      "Error": {
        "description": "Error information from a response.",
        "type": "object",
        "properties": {
          "error_code": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "request_id": {
            "type": "string"
          }
        },
        "required": [
          "message",
          "request_id"
        ]
      },
      "FsmStateKind": {
        "description": "Simplified representation of a BGP state without having to carry a connection.",
        "oneOf": [
          {
            "description": "Initial state. Refuse all incomming BGP connections. No resources allocated to peer.",
            "type": "string",
            "enum": [
              "Idle"
            ]
          },
          {
            "description": "Waiting for the TCP connection to be completed.",
            "type": "string",
            "enum": [
              "Connect"
            ]
          },
          {
            "description": "Trying to acquire peer by listening for and accepting a TCP connection.",
            "type": "string",
            "enum": [
              "Active"
            ]
          },
          {
            "description": "Waiting for open message from peer.",
            "type": "string",
            "enum": [
              "OpenSent"
            ]
          },
          {
            "description": "Waiting for keepaliave or notification from peer.",
            "type": "string",
            "enum": [
              "OpenConfirm"
            ]
          },
          {
            "description": "Sync up with peers.",
            "type": "string",
            "enum": [
              "SessionSetup"
            ]
          },
          {
            "description": "Able to exchange update, notification and keepliave messages with peers.",
            "type": "string",
            "enum": [
              "Established"
            ]
          }
        ]
      },
      "GetImported4Request": {
        "type": "object",
        "properties": {
          "asn": {
            "description": "ASN of the router to get imported prefixes from.",
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          }
        },
        "required": [
          "asn"
        ]
      },
      "GetOriginated4Request": {
        "type": "object",
        "properties": {
          "asn": {
            "description": "ASN of the router to get originated prefixes from.",
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          }
        },
        "required": [
          "asn"
        ]
      },
      "GracefulShutdownRequest": {
        "type": "object",
        "properties": {
          "asn": {
            "description": "ASN of the router to gracefully shut down.",
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          },
          "enabled": {
            "description": "Set whether or not graceful shutdown is initiated from this router.",
            "type": "boolean"
          }
        },
        "required": [
          "asn",
          "enabled"
        ]
      },
      "NewRouterRequest": {
        "type": "object",
        "properties": {
          "asn": {
            "description": "Autonomous system number for this router",
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          },
          "id": {
            "description": "Id for this router",
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          },
          "listen": {
            "description": "Listening address <addr>:<port>",
            "type": "string"
          }
        },
        "required": [
          "asn",
          "id",
          "listen"
        ]
      },
      "Originate4Request": {
        "type": "object",
        "properties": {
          "asn": {
            "description": "ASN of the router to originate from.",
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          },
          "prefixes": {
            "description": "Set of prefixes to originate.",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Prefix4"
            }
          }
        },
        "required": [
          "asn",
          "prefixes"
        ]
      },
      "PeerInfo": {
        "type": "object",
        "properties": {
          "asn": {
            "nullable": true,
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          },
          "duration_millis": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          },
          "state": {
            "$ref": "#/components/schemas/FsmStateKind"
          }
        },
        "required": [
          "duration_millis",
          "state"
        ]
      },
      "PeerState": {
        "description": "The possible peer states. See the `State` trait implementations `Down`, `Init`, and `Up` for detailed semantics.",
        "oneOf": [
          {
            "description": "A stable down state. Non-responsive to incoming messages.",
            "type": "string",
            "enum": [
              "AdminDown"
            ]
          },
          {
            "description": "The initial state.",
            "type": "string",
            "enum": [
              "Down"
            ]
          },
          {
            "description": "The peer has detected a remote peer in the down state.",
            "type": "string",
            "enum": [
              "Init"
            ]
          },
          {
            "description": "The peer has detected a remote peer in the up or init state while in the init state.",
            "type": "string",
            "enum": [
              "Up"
            ]
          }
        ]
      },
      "Prefix4": {
        "type": "object",
        "properties": {
          "length": {
            "type": "integer",
            "format": "uint8",
            "minimum": 0
          },
          "value": {
            "type": "string",
            "format": "ipv4"
          }
        },
        "required": [
          "length",
          "value"
        ]
      },
      "Route4ImportKey": {
        "type": "object",
        "properties": {
          "id": {
            "description": "A BGP route identifier.",
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          },
          "nexthop": {
            "description": "The nexthop/gateway for the route.",
            "type": "string",
            "format": "ipv4"
          },
          "prefix": {
            "description": "The destination prefix of the route.",
            "allOf": [
              {
                "$ref": "#/components/schemas/Prefix4"
              }
            ]
          },
          "priority": {
            "description": "Local priority/preference for the route.",
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          }
        },
        "required": [
          "id",
          "nexthop",
          "prefix",
          "priority"
        ]
      },
      "RouterInfo": {
        "type": "object",
        "properties": {
          "asn": {
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          },
          "graceful_shutdown": {
            "type": "boolean"
          },
          "peers": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/PeerInfo"
            }
          }
        },
        "required": [
          "asn",
          "graceful_shutdown",
          "peers"
        ]
      },
      "SessionMode": {
        "type": "string",
        "enum": [
          "SingleHop",
          "MultiHop"
        ]
      },
      "StaticRoute4": {
        "type": "object",
        "properties": {
          "nexthop": {
            "type": "string",
            "format": "ipv4"
          },
          "prefix": {
            "$ref": "#/components/schemas/Prefix4"
          }
        },
        "required": [
          "nexthop",
          "prefix"
        ]
      },
      "StaticRoute4List": {
        "type": "object",
        "properties": {
          "list": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/StaticRoute4"
            }
          }
        },
        "required": [
          "list"
        ]
      },
      "Withdraw4Request": {
        "type": "object",
        "properties": {
          "asn": {
            "description": "ASN of the router to originate from.",
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          },
          "prefixes": {
            "description": "Set of prefixes to originate.",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Prefix4"
            }
          }
        },
        "required": [
          "asn",
          "prefixes"
        ]
      }
    },
    "responses": {
      "Error": {
        "description": "Error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            }
          }
        }
      }
    }
  }
}